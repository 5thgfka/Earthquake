<!DOCTYPE html>

<div id='main' data-bb-type="screen">
    <div>
	    <table id="earthquaketable" class="table table-striped">
	        <thead id='tbl_header'></thead>
	        <tbody id='tbl_body'>
	            
	        </tbody>
	    </table>
    </div>
    <div data-bb-type="menu">
        <div data-bb-type="menu-item" data-bb-img="img/info.png" onclick="bb.pushScreen('about.html','about');">about</div>
    </div>
</div>
<script>
$.get("http://www.12322.org/csi/datasvr.jsp?order_info=TASK4", 
    function(data, status) {
        //$('#content').text(data);
        xmlDoc = $.parseXML( "<rss version='2.0'>" + data + "</rss>");
        // Localization
        // Start
        var T_head = "<tr><th>{{Epicenter}}</th><th>{{Date}}</th><th>{{LonLat}}</th><th>{{Magnitude}}</th></tr>";
        var C_head = Handlebars.compile(T_head);
        var lang = blackberry.system.language;
        var dict = languages[(lang).substring(0,2)] == undefined ? languages['en']:languages[(lang).substring(0,2)];
        var plain = C_head(dict);
        // End
        $("#earthquaketable>thead").append(plain);
        for (var i = 0; i < 50; i++) {
            var type = xmlDoc.getElementsByTagName('eq_type'+i)[0].textContent;
            var otime = xmlDoc.getElementsByTagName('o_time'+i)[0].textContent;
            var lat = xmlDoc.getElementsByTagName('lat'+i)[0].textContent;
            var lon = xmlDoc.getElementsByTagName('lon'+i)[0].textContent;
            var location = xmlDoc.getElementsByTagName('location_name'+i)[0].textContent;
            var depth = xmlDoc.getElementsByTagName('depth'+i)[0].textContent;
            var m = xmlDoc.getElementsByTagName('m'+i)[0].textContent;

            var html_row = 
                        "<tr>"+
                            "<td>"+ location + "</td>"+
                            "<td>"+ otime + "</td>"+
                            "<td>("+ lat+","+lon + ")</td>"+
                            "<td>"+ m + "</td>"+
                            "<td style='display:none;'>"+ type + "</td>"+
                            "<td style='display:none;'>"+ depth + "</td>"+
                        "</tr>";
            $("#earthquaketable>tbody").append(html_row);
        };

        $("#earthquaketable tr").click(function(){
        	// 点击一行则弹出具体信息页面
        	var tds = $(this).children('td');
        	var params = {}

        	for(var i = 0; i<tds.length; i++) {
        		params[i] = $(tds[i]).html();
        	}
        	
        	bb.pushScreen('details.html', 'details', params);
        })
    }
);
</script>